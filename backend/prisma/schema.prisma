generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model InstituteName {
  id        String         @id @default(uuid())
  name      String
  state     String
  city      String
  pincode   String
  type      InstituteType
  levelType InstituteLevel // SEMESTER / CLASS / BATCH
  levels    Int // total levels (e.g. 8 or 12)

  admins   Admin[]
  students Student[]
  classes  Class[]
  mentors  Mentor[] // ðŸ”¹ back relation for Mentor.institute
}

model Admin {
  id          String        @id @default(ulid())
  email       String        @unique
  instituteId String
  institute   InstituteName @relation(fields: [instituteId], references: [id])

  mentors Mentor[] // ðŸ”¹ back relation for Mentor.admin
}

model Class {
  id          String        @id @default(ulid())
  name        String
  level       Int // e.g. Class 9, Semester 3 etc.
  instituteId String
  institute   InstituteName @relation(fields: [instituteId], references: [id])

  mentorId String?
  mentor   Mentor? @relation(fields: [mentorId], references: [id])

  students Student[]
  subjects Subject[]
}

model Subject {
  id     String  @id @default(ulid())
  name   String
  code   String? @unique
  credit Int?

  classId String
  class   Class  @relation(fields: [classId], references: [id])

  progress StudentProgress[]
}

model Mentor {
  id    String @id @default(ulid())
  email String @unique

  instituteId String
  institute   InstituteName @relation(fields: [instituteId], references: [id])

  adminId String
  admin   Admin  @relation(fields: [adminId], references: [id]) // ðŸ”¹ completes Admin.mentors

  classes Class[]
}

model Student {
  id          String  @id @default(ulid())
  enroll_no   String
  name        String
  email       String?
  parentEmail String?
  parentPhone String?

  instituteId String
  institute   InstituteName @relation(fields: [instituteId], references: [id])

  classId String?
  class   Class?  @relation(fields: [classId], references: [id])

  currentLevel Int? 

  progress StudentProgress[]
}

model StudentProgress {
  id String @id @default(ulid())

  studentId String
  student   Student @relation(fields: [studentId], references: [id])

  subjectId String
  subject   Subject @relation(fields: [subjectId], references: [id])

  level      Int // which level/semester/class
  marks      Int?
  attendance Int?
  payment    Boolean?
  // could add: term, year, remarks, riskScoreSnapshot, etc.

  @@unique([studentId, subjectId, level])
}

enum InstituteType {
  COLLEGE
  SCHOOL
  COACHING
  POLYTECHNIC
}

enum InstituteLevel {
  SEMESTER
  CLASS
  BATCH
}
